---
kind: Build
type: container
name: api-build
description: The backend build for the voting UI

---
kind: Deploy
type: kubernetes
name: api
build: api-build
description: The backend deploy for the voting UI
spec:
  files:
    - manifests/*
  defaultTarget:
    kind: Deployment
    name: api
  sync:
    overrides:
      - args: ["/bin/sh", "-c", "ls /app/app.py | entr -n -r python /app/app.py"]
    paths:
      - containerPath: /app
        mode: "one-way-replica"
        exclude: [.venv]
variables:
  image: "${actions.build.api-build.outputs.deployment-image-id}"
dependencies:
  - deploy.redis
  - build.api-build

---
kind: Test
type: container
name: unit
description: Unit test for backend API
build: api-build
spec:
  args: ["echo", "ok"]
